# Codex MCP 서버 설계 토론

영어 버전(`mcp-server-discussion.md`)이 활성 설계 노트의 기준입니다.
이 문서는 동기화된 한국어 번역본입니다.

## 운영 규칙

- 이 문서는 고정 최종 명세가 아니라 살아있는 설계 로그입니다.
- 의사결정이 발생하면 즉시 업데이트합니다.
- 긴 세션 후 일괄 갱신하지 말고, 증분 단위로 바로 기록합니다.

## 문제 정의

- 사용자는 대체로 모호한 목표로 시작합니다.
- 구조화된 구체화 없이 바로 실행하면 불일치와 재작업이 발생합니다.
- 의도, 계획, 실행의 연결이 약하면 신뢰도가 하락합니다.

## 제품 목표

Codex 신뢰도를 높이는 로컬 Go MCP 서버를 구축합니다. 핵심은 아래를 강제하는 것입니다.
- 구조화된 의도 수집,
- 단계적 계획/실행/검증,
- 명시적 사용자 승인 게이트,
- 재개 가능한 지속 상태.

## 핵심 원칙

- 출력 속도보다 의도 정합성.
- 작은 단위 확정과 빠른 피드백.
- 민감한 경계에서의 인간 통제.
- 추적 가능한 상태를 가진 재현 가능한 워크플로우.
- 복구 가능한 실패 루프.
- 최소 권한 기본 실행.

## 현재 아키텍처 요약

- 워크플로우 상태 머신을 강제합니다.
- 세션 영속화는 JSON + SQLite를 사용합니다.
- `generate_plan` 이전에 council 기반 기획을 필수로 둡니다.
- 상담 루프는 턴당 1개의 집중 질문으로 요구사항을 다듬습니다.
- UI/UX 작업에서는 조건부로 시각 검토 게이트를 요구합니다.
- 최종 완료에는 명시적 사용자 승인이 필요합니다.

## 동적 council 팀

- Council 팀장은 세션 범위(`council_managers`)로 관리됩니다.
- 팀 구성 방법:
  - `council_configure_team` (`append|replace|remove`)
  - `council_start_briefing`에서 원샷 업데이트 (`manager_mode`, `managers`)
- 안건 참여/종결 검사는 하드코딩 역할 목록이 아니라 활성 세션 팀장을 기준으로 동작합니다.

## 설치 정책

`make agent-install`은 필수 동의/인터뷰 게이트를 포함합니다.

1. 약관 동의 (필수)
   - 소프트웨어는 충분히 검증되지 않았음
   - 문제/손해에 대한 책임은 사용자에게 있음
   - GNU GPL v3.0 라이선스를 인지함
2. 설치 범위 선택 (`global` 또는 `local`)
3. Playwright MCP 등록(선택)
4. 초기 전문성 설문 프로필 수집

설치기는 기본 사용자 프로필과 런타임 런처 연결을 기록합니다.

## 모델 라우팅 기준선

- 상담가: `gpt-5.2`
- 오케스트레이터/리뷰어: `gpt-5.3-codex`
- 작업자: `gpt-5.3-codex-spark`

## 검증 기준선

- `make test` 통과 필수.
- `make smoke` 통과 필수.
- 설치기 변경은 대화형/비대화형 경로 모두 지원해야 함.

## 다음 업데이트 원칙

- 영어 문서를 기준으로 유지합니다.
- 한국어 문서가 필요하면 `*.ko.md` 대응 문서를 병렬 업데이트합니다.
